<!DOCTYPE html>
<html lang=" en" class="antialiased"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Install Microsoft Teams with Intune, PowerShell &#038; Bits! | Powers Hell</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Install Microsoft Teams with Intune, PowerShell &#038; Bits!" />
<meta name="author" content="Ben" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I know most people out there cringe at the thought of spending time packaging applications for deployment, but unfortunately I seem to be a sucker for punishment and really do revel in the challenges faced with application packaging!" />
<meta property="og:description" content="I know most people out there cringe at the thought of spending time packaging applications for deployment, but unfortunately I seem to be a sucker for punishment and really do revel in the challenges faced with application packaging!" />
<link rel="canonical" href="https://powers-hell.com/2018/04/17/install-microsoft-teams-with-intune-powershell-bits/" />
<meta property="og:url" content="https://powers-hell.com/2018/04/17/install-microsoft-teams-with-intune-powershell-bits/" />
<meta property="og:site_name" content="Powers Hell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-04-16T16:44:12+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Install Microsoft Teams with Intune, PowerShell &#038; Bits!" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Ben"},"description":"I know most people out there cringe at the thought of spending time packaging applications for deployment, but unfortunately I seem to be a sucker for punishment and really do revel in the challenges faced with application packaging!","url":"https://powers-hell.com/2018/04/17/install-microsoft-teams-with-intune-powershell-bits/","@type":"BlogPosting","headline":"Install Microsoft Teams with Intune, PowerShell &#038; Bits!","dateModified":"2018-04-16T16:44:12+00:00","datePublished":"2018-04-16T16:44:12+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://powers-hell.com/2018/04/17/install-microsoft-teams-with-intune-powershell-bits/"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/app.css">
    <link rel="stylesheet" href="/assets/css/prism-dracula.css">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js" defer></script>
    <script data-ad-client="ca-pub-3537558222002149" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SGKQTF5F0T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SGKQTF5F0T');
</script>
    <style type="text/css">
        :root {
            --dynamic-page-color: cyan;
        }
    </style>
</head><body><div class="page-container">
    <div class="">
        <nav x-data="{ open: false }" class="nav sticky drac-bg-blackBlack">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16 px-4 sm:px-0">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 link-hover">
                            <h2 class="drac-heading drac-heading-xl"><a href="/">Powers Hell</a></h2>
                        </div>
                        <div class="hidden md:block flex-shrink-0">
                            <div class="ml-10 flex items-baseline space-x-4">
                                <div id="tagalign" class="drac-text drac-text-cyan drac-text-right drac-line-height">
                                    great/power/is/great/fun >
                                    <div class="cursor"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="hidden md:block flex-shrink-0">
                        <div class="block md:hidden">
    <div class="ml-3 items-center relative">
        <a href="/"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan hover:drac-text-white drac-btn-sm drac-m-sm">Home</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/about"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">About</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/archives"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Archives</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/categories"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Categories</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="https://merch.powers-hell.com"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Merch</a>
    </div>
</div>
<div class="hidden md:block">
    <a href="/"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan hover:drac-text-white drac-btn-sm drac-m-sm">Home</a>
<a href="/about"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">About</a>
<a href="https://merch.powers-hell.com"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Merch</a>
</div>



                    </div>
                    <div class="mr-2 flex md:hidden">
                        <!-- Mobile menu button -->
                        <button type="button"
                            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm items-center justify-center p-2"
                            aria-controls="mobile-menu" aria-expanded="false" @click="open = !open" ara-expanded="false"
                            x-bind-aria-expanded="open.toString()">
                            <span class="sr-only">Open main menu</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" x-state:on="Menu open"
                                x-state:off="Menu closed" :class="{ 'hidden':open, 'block': !(open) }">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>

                            <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" x-state:on="Menu open"
                                x-state:off="Menu closed" :class="{ 'block':open, 'hidden': !(open) }">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="drac-bg-black md:hidden" x-show.transition="open">
                <div class="px-2 py-3 space-y-1 sm:px-3 items-center">
                    <div id="tagalign" class="ml-3 drac-text drac-text-cyan drac-line-height">
                        great/power/is/great/fun >
                        <div class="cursor"></div>
                    </div>
                    <div class="block md:hidden">
    <div class="ml-3 items-center relative">
        <a href="/"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan hover:drac-text-white drac-btn-sm drac-m-sm">Home</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/about"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">About</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/archives"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Archives</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="/categories"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Categories</a>
    </div>
    <div class="ml-3 items-center relative">
        <a href="https://merch.powers-hell.com"
            class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Merch</a>
    </div>
</div>
<div class="hidden md:block">
    <a href="/"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan hover:drac-text-white drac-btn-sm drac-m-sm">Home</a>
<a href="/about"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">About</a>
<a href="https://merch.powers-hell.com"
    class="drac-btn drac-bg-purple-transparent drac-btn-ghost drac-text-cyan drac-btn-sm drac-m-sm">Merch</a>
</div>



                </div>
            </div>
        </nav>
      <div class="drac-bg-blackBlack pb-6 md:pb-24 lg:pb-28 xl:pb-8">
        <header class="py-10"><div class="main-overlay max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <h1
        class="drac-heading drac-heading-2xl drac-text-center drac-text-cyan">
        
        Install Microsoft Teams with Intune, PowerShell &#038; Bits!
        
    </h1>
    
</div></header>
      </div>
      <div>
        <svg class="wave" viewBox="0 0 1792 335" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M 0 50 C 259 50 259 209 518 209 L 518 209 L 518 0 L 0 0 Z" stroke-width="0"></path>
        <path d="M 517 209 C 800 209 800 96 1083 96 L 1083 96 L 1083 0 L 517 0 Z" stroke-width="0"></path>
        <path d="M 1082 96 C 1437 96 1437 189 1792 189 L 1792 189 L 1792 0 L 1082 0 Z" stroke-width="0"></path>
        </svg>
      </div><main class="-mt-4 md:-mt-64 lg:-mt-72 xl:-mt-80 2xl:-mt-96 4xl:-mt-112">
    <div class="main-overlay max-w-5xl mx-auto pb-12 px-4 sm:px-6 lg:px-8">
        <div class=" break-normal md:break-word drac-bg-black rounded-lg shadow-2xl px-5 py-6 sm:px-6">
            <article class="markdown-body drac-text drac-line-height line-numbers">

                <p class="post-date drac-text drac-text-xs"><font class="drac-text-black-secondary">Published:</font>
                    <font class="drac-text-cyan"> 16 Apr 2018</font>
                    <br/>
                    <font class="drac-text-black-secondary">File under:</font>
<font class="drac-text drac-text-xs">
    <a href="/category/powershell/" class="related">PowerShell</a></font></p>
                 <p>Hi All,</p>

<p>I know most people out there cringe at the thought of spending time packaging applications for deployment, but unfortunately I seem to be a sucker for punishment and really do revel in the challenges faced with application packaging!</p>

<p>Here’s a nice and easy one that will help anyone tasked with getting the latest version of the Teams client onto devices - whether using SCCM or Intune, you will find a use for the code below.</p>

<p>The version release cycle of Microsoft Teams is rapid - so much so that if you were tasked with maintaining the latest installation media for your business deployment solution, you’ll very quickly find that it would take up a lot of your time just keeping your local repositories up to date. Of course, the client itself has a very robust update engine, so it *technically* doesn’t matter what version you initially install, for sanity’s sake and for a little bit more control, it’s best to try and start with the latest version.</p>

<p>The trick here is to not worry about maintaining a local version of the installation media and simply force the device to pull down the latest version from the official repo!</p>

<p>Onto the solution!</p>

<p>After a bit of digging and monitoring with fiddler on the <a href="https://teams.microsoft.com/downloads/" target="_blank" rel="noopener">Teams download page</a>, I identified the way the URLs were being formed to request the correct media. Below is a breakdown.</p>

<table>
  <thead>
    <tr>
      <th><strong>Type</strong></th>
      <th><strong>Value</strong></th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Base URL</td>
      <td>https://teams.microsoft.com/downloads/DesktopURL?</td>
      <td> </td>
    </tr>
    <tr>
      <td>Environment</td>
      <td>&amp;env=production</td>
      <td> </td>
    </tr>
    <tr>
      <td>Platform</td>
      <td>&amp;plat={windows</td>
      <td>osx}</td>
    </tr>
    <tr>
      <td>OSArchitecture</td>
      <td>&amp;arch={x86</td>
      <td>x64}</td>
    </tr>
  </tbody>
</table>

<p>Quite straightforward! So if we want to pull down the latest Windows 64-bit client, we simply create the URL shown below:</p>

<p>https://teams.microsoft.com/downloads/DesktopURL?&amp;env=production&amp;plat=windows&amp;arch=x64</p>

<p>So now lets throw that URL into a powershell web-request…</p>

<pre><code class="language-PowerShell">Invoke-WebRequest -Uri "https://teams.microsoft.com/downloads/DesktopURL?&amp;env=production&amp;plat=windows&amp;arch=x64" -UseBasicParsing
</code></pre>

<p>And the result of that command below..</p>

<p><a href="https://i1.wp.com/i.imgur.com/rgVnHO9.png?w=1170&#038;ssl=1" title="invoke-webrequest"><img src="https://i1.wp.com/i.imgur.com/rgVnHO9.png?w=1170&#038;ssl=1" alt="invoke-webrequest" /></a></p>

<p>Success! if we have a look at the content of the result of the web-request we can see the URL of the latest 64-bit Teams client!</p>

<p>Now that we know the process to retrieve the media, we can turn the whole process into a function that can be deployed out to devices to pull down the install media.</p>

<p>Below is the function I have created to programatically form the correct URL based on our requirements - aside from creating the URL and capturing the file URL, all that is left to be done is pull down the content using Bits &amp; a little bit of error handling!</p>

<pre><code class="language-PowerShell">function Get-MicrosoftTeamsClient {
    [CmdletBinding()]
    param(
        [parameter()]
        [ValidateSet(, "production")]
        [string]$env = "production",

        [parameter()]
        [ValidateSet(, "windows", "osx")]
        [string]$platform = "windows",

        [parameter()]
        [ValidateSet(, "x64", "x86")]
        [string]$osArch = "x64",

        [parameter(Mandatory = $true)]
        [string]$destinationPath
    )
    switch ($platform) {
        "windows" {
            $uri = "https://teams.microsoft.com/downloads/DesktopURL?env=$($env)&amp;plat=$($platform)&amp;arch=$($osArch)"
            break
        }
        "osx" {
            $uri = "https://teams.microsoft.com/downloads/DesktopURL?env=$($env)&amp;plat=$($platform)"
            break
        }
    }

    $contentURI = Invoke-WebRequest -Uri $uri -UseBasicParsing
    $contentName = ($contentURI.content -split "/")[-1]
    $result = @{}
    $result.FilePath = "$destinationPath\$contentName"
    if (!(Test-Path $destinationPath)) {
        New-Item -Path $destinationPath -ItemType Directory -Force | out-null
    }
    Write-Host "Downloading $contentName" -ForegroundColor Green
    if (!(test-path "$($destinationPath)\$($contentName)")) {
        $bitsJob = Start-BitsTransfer -Source $($contentURI.content) -Destination "$($destinationPath)\$($contentName)" -Asynchronous
        start-sleep -Seconds 1
        Write-Host "Total filesize: $($bitsJob.BytesTotal)" -ForegroundColor Yellow
        While ($bitsJob | Where-Object {$bitsJob.JobState -eq "Transferring"}) {
            Start-Sleep -Seconds 2
        }
        Write-Host "Total transferred: $($bitsJob.BytesTransferred)" -ForegroundColor Green
        if ($bitsJob.BytesTotal -eq $bitsJob.BytesTransferred) {
            Get-BitsTransfer -JobId $bitsJob.JobId | Complete-BitsTransfer
            $result.result = "Downloaded"
            return $result
        }
        else {
            Write-Host "Error during download - file size mismatch" -ForegroundColor Red
            $result.result = "Failed"
            return $result
        }
    }
    else {
        Write-Host "$contentName already found at location: $destinationPath" -ForegroundColor Yellow
        $result.result = "Found"
        return $result
    }
}
</code></pre>

<p>Now that you have a function to easily retrieve the latest installation media, all that is required is to handle the installation which of course will vary between operating systems.
Once you have a working installation script, it’s then a piece of cake to deploy via sidecar in Intune (or SCCM - any deployment method will suffice!)</p>

<p>I’ve provided a fully functioning example to download and install the latest 64-bit Client for windows in my <a href="https://github.com/tabs-not-spaces/CodeDump/tree/master/Install-MicrosoftTeams" rel="noopener" target="_blank">GitHub repository</a> for your preusal / review.</p>

<p>Hopefully this has been helpful to you and always, if you have any improvements / complaints or just wish to discuss the solution provided above, leave a comment below or reach me on twitter <a href="https://twitter.com/powers_hell" rel="noopener" target="_blank">@powers_hell</a></p>

<p>Enjoy,
Ben</p>

            </article>
        </div>
    </div><div class="main-overlay max-w-5xl mx-auto pb-4 overflow-hidden">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3537558222002149" crossorigin="anonymous"></script>
    <!-- horizontal-ad-unit -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3537558222002149" data-ad-slot="4617860412" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div><div class="pagination main-overlay max-w-5xl mx-auto pb-12 px-4 sm:px-6 lg:px-8 drac-text-white drac-text-center utterances">
    <div class="drac-box drac-mb-sm">
        <hr class="drac-hr-bg-cyan" />
    </div>
    <script src="https://utteranc.es/client.js" repo="tabs-not-spaces/powers-hell-blog" issue-term="title" theme="github-dark" crossorigin="anonymous" async>
    </script>
</div></main>
  </div><script src="/assets/js/app.js"></script>
<script src="/assets/js/prism.js"></script>
<script type="text/javascript" src="/assets/js/lightbox.js"></script>
<link rel="stylesheet" href="/assets/css/lightbox.css">
</div>
<div>
    <svg class="wave" viewBox="0 0 1792 95.1" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path
            d="M1792,95.1c0-27,0-54,0-80.9c-40.7-5.1-101.2-11-174.5-12.3c-185.3-3.3-260.9,26.8-411.8,42.6
c-297.5,31.2-285-56-548.1-16.1C536.2,46.6,452.1,77.6,335.5,43C294,30.7,251,10.8,179.2,3C104.9-5,42.2,4.5,0,14.1v80.9H1792z" />
    </svg>
    <footer class="main-overlay drac-bg-blackBlack flex flex-wrap items-center justify-between p-3 m-auto">
        <div class="container mx-auto flex flex-col flex-wrap items-center justify-between">
            <div class="flex mx-auto drac-text-white text-center">
                <span>
                    <p class="drac-text-purple-cyan">
                        Powers Hell © 2021
                    </p>
                </span>
            </div>
            <div class="flex mx-auto drac-text-white text-center">
                <span>
                    <p>
                        made by
                        <a href="https://twitter.com/powers_hell" target="_blank" class="drac-text-yellow">
                            Ben
                        </a>
                        with
                        <a href="https://github.com/tabs-not-spaces/powers-hell-blog" target="_blank"
                            class="drac-text-yellow-pink">
                            code, coffee & beer
                        </a>
                        🍻
                    </p>
                </span>
            </div>
        </div>
    </footer>
</div></body>

</html>